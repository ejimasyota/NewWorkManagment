## OS
 - Ubuntu-22.04

## Webサーバ
 - Apache2

## 開発言語
### 1. フロントエンド
 - 1. HTML
 - 2. JavaScript
### 2. バックエンド
 - 1. PHP

## UI構築
 - 1. CSS
 - 2. Font Awesome

## RDBMS
 - PostgreSQL

## DB情報
 - ユーザー名
   - ejima
 - DB名
   - WorkManagement
 - パスワード
   - WorkManagement@2026
 - ホスト
   - 127.0.0.1

## バージョン管理
 - Git

## パッケージ管理
 - Composer

## ライブラリ
 - 1. PHPWord

## エディター
 - Visual Studio Code

## 開発目的
 - 友人からの依頼と自己学習
 - 作品に関しての資料管理を統合的に行うため
 - 複数人での作品制作を行う際に作品設定を円滑に共有するため
 - 作品のプレゼンを行う際に資料の出力を容易にするため

## 開発方針
 - JSDoc・PHPDoc・コメントの記述は必ず行う
 - 操作ログ出力を行う
   - 出力のタイミングはAPIの処理開始時と終了時、例外発生時とする
   - ログファイルの名称は[作品管理システム_現在年月日.log]とする
   - ログファイルが存在すれば追記、存在しなければ作成と書き込みを行う
   - 操作ログはLog/Infoディレクトリに出力を行い、エラーログはLog/Errorディレクトリに出力を行う
 - 共通関数による処理を多用し、維持・保守の効率化を図る
   - CSSに関しても同様に、機能別ではなく共通性の高いクラスを作成する
 - API呼び出し時には画面にスピナーを表示させる
 - 各テーブルには登録年月日・更新年月日・登録者・更新者のカラムを必ず追加する
   - 登録年月日・更新年月日の型はTIMESTAMP(3)とする
 - ファイル名・関数名・変数名・クラス名は、いずれもパスカルケースで記述を行う
 - JSDoc・PHPDoc・コメントの記述は必ず行う
 - 画面に一覧を表示させるような画面では、15レコードにつき1ページでページングを行う
 - PC・スマホ端末での操作を想定していため、レスポンシブ対応を実装する
 - テーブルセルに設定する値がテーブルセル内に収まりきらない場合は設定値の末尾を[・・・]と表示させる。入力フォームでも同様
   - あくまで表示を変更するのみ
   - 主にDBにテキスト型で保持されている値を表示する際に行う。
 - 数値は3桁カンマ区切りを行う
 - 画面で年月日の表示を行う際は[yyyy年MM月dd日]の形式で表示を行う
   - 同様に年であれば[yyyy年]、年月であれば[yyyy年MM月]と記載を行う
 - カレンダーにはデートピッカーを使用する
    - yyy年MM月dd日・yyyy年MM月・yyyy年の形式のいずれかを自由に選択できれば最良
 - 各画面にて、作品に関するテーブルの登録・更新・削除を行った場合は作品情報テーブルの更新年月日と更新者を更新し、更新履歴テーブルに更新年月日と更新者、機能名、操作を登録する
   - プロジェクトがいつ更新され、誰が最後にプロジェクトを更新したかを判別するため
 - ログイン後、画面上で一定時間の操作が行われない場合はセッションをクリアし、ログイン画面へリダイレクトさせる
   - 1時間以上操作がない場合はこの動作を行う
   - 再度ログイン後に、ログアウト前に表示されていた画面へ遷移する
 - 出力を行う画面では、出力内容はファイルダウンロードにて出力を行う
   - バックエンドのディレクトリに一時的にファイルの実体を作成する場合は、ダウンロード処理終了後にそのファイルを削除する
 - 画像ファイルなどの登録を行う際は、画像の実体をサーバの任意のディレクトリに配置し、DBには画像パスの登録を行うようにする
 - 更新者のカラムには、ユーザーIDを登録する
 - 入力フォームやセレクトボックスにはラベルを使用せず、プレースホルダーに手項目名を設定する
   - セレクトボックスの場合は1番上の項目をプレースホルダーとして設定する
 - インフォメッセージ・エラーメッセージ・コンファームメッセージなどは役割ごとにJSなどにまとめ、それらを呼び出すようにする
   - バックエンド側で設定するレスポンスのメッセージなどは仕方ないのでべた書きする
 - 一覧の登録・更新・削除を行った場合は、必ず一覧取得の処理を呼び出す
 - 一覧の表示を行う画面では件数の表示も行う
 - JSにてDOM要素を作成する際はcleateElementを使用する
 - プルダウンの内容はJSの共通関数にまとめて、それを呼び出すようにする
 - DBのレコードの削除は基本的に物理削除とする
 - DBにテキスト型で保持されている値の表示を行う入力フォームの右隣には詳細ボタンを配置する
   - 詳細ボタン押下時に入力エリアダイアログを表示させ、そこに全文を表示させる
   - 入力フォーム自体は非活性状態とする
   - DBには入力エリアダイアログの内容を登録するので、hiddenでテキストエリアの要素も作成しておく
 - 画像ボックス内の画像をクリックした際は、画像ダイアログを表示させること
   - セルの画像クリックではこの動作は行わない。あくまでフォーム上の画像ボックスのクリック時のみ
 - 日付に関する値はDB側ではVARCHARで保持する
 - DB接続情報はenvで保持する
 - テキストエリアのリサイズは無しにする
 - 機能画面のロード時は利用者区分の判定を行う
 - ログイン画面はプロジェクト直下のindex.htmlに作成すること(Apacheが読むために)

## テーブルセルに設定する値がテーブルセル内に収まりきらない場合は設定値の末尾を[・・・]と表示させるJS関数
以下のようなものを想定
```
/**
 * 文字数を制限して末尾を省略する関数
 * @param {string} text      末尾の省略を行う文字列
 * @param {int}    maxLength 省略を行う基準となる桁数の指定
 * @returns 省略後の文字列を返す
 */
function truncateText(text, maxLength = 20) {
  // 1.省略対象の文字列が取得できなかった場合は処理を行わない
  if (!text) {
    return "";
  }

  // 2.省略対象文字列が、指定桁数を超えている場合は末尾の省略を行う
  if (text.length > maxLength) {
    return text.slice(0, maxLength) + "…";
  }

  // 3.省略後の文字列を返す
  return text;
}
```
ただしこれでは半角全角によってリプレイスされるUI上の位置がセルごとに代わってしまうため、できれば一定幅を超えた際にリプレイスにした方がよい

## UUIDの発行用JS関数
以下のようなものを想定
```
/**
 * UUIDの生成を行う関数
 * @returns {string} 生成されたUUIDの文字列
 */
function GenerateUUID() {
  // 1.乱数を利用した簡易UUID
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
    const r = (Math.random() * 16) | 0;
    const v = c === "x" ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
}
```

## プルダウンの内容を生成するJS関数
以下のようなものを想定
```
/**
 * プルダウンの内容を生成する処理
 * @param   {string} type 取得するプルダウンのキー
 * @returns {string} optionタグ群の文字列
 */
function PullDownList(type) {
  /* 各プルダウンの内容を定義 */
  const dataMap = {
    // 1.作品ジャンル区分
    genre: [
      { value: 0, label: "未設定" },
      { value: 1, label: "ホラー" },
      { value: 2, label: "ファンタジー" },
      { value: 3, label: "SF" },
      { value: 4, label: "恋愛" },
      { value: 5, label: "日常" },
      { value: 6, label: "アクション" },
      { value: 7, label: "冒険" },
      { value: 8, label: "ミステリー" },
      { value: 9, label: "コメディ" },
      { value: 10, label: "スポーツ" },
      { value: 11, label: "歴史" },
      { value: 12, label: "学園" },
      { value: 13, label: "その他" },
    ],
    // 2.レビュー評価区分
    review: [
      { value: 0, label: "" },
      { value: 1, label: "◎" },
      { value: 2, label: "〇" },
      { value: 3, label: "△" },
      { value: 4, label: "✕" },
    ]
  };
  /* 指定されたキーに対応するデータを取得 */
  const list = dataMap[type];

  /* 一致するデータが存在しなければ空文字を返して処理終了 */
  if (!list) {
    return "";
  }
  /* 「未設定（value === 0）」項目を先頭に持ってきてプレースホルダー化する
   * - 先頭に移動して initial selected にする
   * - disabled にせず選択可能のままにする（ユーザーが戻せる） */
  const zeroIndex = list.findIndex((item) => item.value === 0);
  let items;
  if (zeroIndex !== -1) {
    // 既に先頭ならそのまま、そうでなければ先頭に移動
    if (zeroIndex === 0) {
      items = list.slice();
    } else {
      items = [list[zeroIndex]].concat(list.filter((_, i) => i !== zeroIndex));
    }
  } else {
    // value===0 の項目が無ければ既存の list をそのまま使用
    items = list.slice();
  }

  /* optionタグ文字列を組み立てて返す
   * - 先頭項目（プレースホルダーとみなす）には selected と data-placeholder を付与する（選択可能） */
  return items
    .map((item, idx) => {
      if (idx === 0) {
        // 先頭はプレースホルダー扱い（選択可能）
        return `<option value="${item.value}" selected data-placeholder="true">${item.label}</option>`;
      }
      return `<option value="${item.value}">${item.label}</option>`;
    })
    .join("");
}
```

## CDで返ってきた項目の値の名称を取得するJS関数
以下のようなものを想定
```
/**
 * CDをもとにプルダウンの値を取得する関数
 * @param  {string} Type PullDownList関数に指定するキー
 * @param  {string} cd   値を取得したいCD
 * @return {string} 取得したCDの値
 */
function GetKeyInfo(Type, Cd) {
  // 1.PullDownList関数を使ってoption群のHTMLを生成
  const OptionsHtml = PullDownList(Type);

  // 2.仮のselect要素を作成
  const Temp = document.createElement("select");

  // 3.仮のselect要素に項番1で取得した値をセットしてDOMとして扱う
  Temp.innerHTML = OptionsHtml;

  // 4.valueが一致するoptionを取得
  const option = Array.from(Temp.options).find((Opt) => Opt.value == Cd);

  // 5.CDの値を返す
  return option ? option.text : "";
}
```

## ファイルのダウンロードを行う共通関数
以下のようなものを想定
```
/**
 * 共通：Blobをダウンロード
 * @param {Blob} blob バイナリデータ
 * @param {string} filename 保存名
 */
function DownloadFile(blob, filename) {
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  window.URL.revokeObjectURL(url);
}
```

## デートピッカーダイアログの想定
以下のようなものを想定していますが、処理ロジックやCSSクラスなどは実装にあたって要変更
```
/* ==========================================================
 * DatePicker クラス（独自ダイアログ版 改良＋ゼロ埋め補正付き）
 * ========================================================== */
class DatePicker {
  constructor() {}

  /**
   * 指定IDの input に日付を設定するダイアログを表示
   * @param {string} elementId 入力値反映先の要素ID
   */
  openDialog(elementId) {
    return new Promise((resolve) => {
      const target = document.getElementById(elementId);
      const currentVal = (target?.value || "").trim();

      /* ------------------------------
       * 1. ダイアログ背景
       * ------------------------------ */
      const overlay = document.createElement("div");
      overlay.classList.add("DialogOverlay");

      /* ------------------------------
       * 2. ダイアログ本体
       * ------------------------------ */
      const dialog = document.createElement("div");
      dialog.classList.add("DialogContainer", "w-500");

      /* ▼ 入力モード選択 */
      const modeSelect = document.createElement("select");
      modeSelect.className = "SelectForm";
      modeSelect.style.width = "100px";
      modeSelect.innerHTML = `
        <option value="year">年</option>
        <option value="year-month">年月</option>
        <option value="date">年月日</option>
      `;

      /* ▼ 入力欄 */
      const input = document.createElement("input");
      input.className = "InputForm";
      input.value = currentVal;
      input.inputMode = "numeric";

      /* ==========================================================
       * モード自動判定・更新関数
       * ========================================================== */
      const detectModeFromValue = (val) => {
        const num = val.replace(/[^0-9]/g, "");
        if (num.length === 8) return "date";
        if (num.length === 6) return "year-month";
        if (num.length === 4) return "year";
        return "year";
      };

      const updatePlaceholder = () => {
        if (modeSelect.value === "year") {
          input.placeholder = "例: 2025";
          input.maxLength = 4;
        } else if (modeSelect.value === "year-month") {
          input.placeholder = "例: 202507";
          input.maxLength = 6;
        } else {
          input.placeholder = "例: 20250724";
          input.maxLength = 8;
        }
        input.focus();
      };

      /* 初期モード設定（既存値から推定） */
      if (currentVal) {
        modeSelect.value = detectModeFromValue(currentVal);
      } else {
        modeSelect.value = "year";
      }
      updatePlaceholder();

      modeSelect.onchange = () => {
        input.value = "";
        updatePlaceholder();
      };

      /* ==========================================================
       * 入力制御（数字のみ・桁制限）
       * ========================================================== */
      input.addEventListener("input", (e) => {
        e.target.value = e.target.value.replace(/[^0-9]/g, "");
        const maxLen = parseInt(input.maxLength, 10);
        if (e.target.value.length > maxLen) {
          e.target.value = e.target.value.slice(0, maxLen);
        }
      });

      /* ==========================================================
       * ボタン類
       * ========================================================== */
      const btnArea = document.createElement("div");
      btnArea.className = "SummaryDialogButtonForm";

      const okBtn = document.createElement("button");
      okBtn.classList.add("ButtonClass", "SaveButton");
      okBtn.innerHTML = "💾 決定";

      const clearBtn = document.createElement("button");
      clearBtn.classList.add("ButtonClass", "ClearButton");
      clearBtn.innerHTML = "🔄 クリア";

      const closeBtn = document.createElement("button");
      closeBtn.classList.add("ButtonClass", "CloseButton");
      closeBtn.innerHTML = "❎ 閉じる";

      btnArea.append(closeBtn, clearBtn, okBtn);
      dialog.append(modeSelect, input, btnArea);
      document.body.append(overlay, dialog);
      input.focus();

      /* ------------------------------
       * 閉じ処理
       * ------------------------------ */
      const escHandler = (e) => {
        if (e.key === "Escape") close();
      };

      const cleanup = () => {
        document.removeEventListener("keydown", escHandler);
      };

      const close = (returnValue = undefined) => {
        cleanup();
        if (dialog.parentNode) dialog.remove();
        if (overlay.parentNode) overlay.remove();
        resolve(returnValue);
      };

      document.addEventListener("keydown", escHandler);

      overlay.onclick = (e) => {
        if (e.target === overlay) close();
      };

      closeBtn.onclick = () => close();
      clearBtn.onclick = () => {
        input.value = "";
        input.focus();
      };
      okBtn.onclick = () => {
        const formatted = formatValue(input.value, modeSelect.value);
        target.value = formatted || "";
        close(formatted);
      };

      /* ==========================================================
       * 値整形（ゼロ埋め対応）
       * ========================================================== */
      function formatValue(value, mode) {
        value = value.trim();
        if (!value) return "";

        // 年モード（例: 2025）
        if (mode === "year") {
          return value.length === 4 ? value : "";
        }

        // 年月モード（例: 20251 → 202501）
        if (mode === "year-month") {
          const y = value.slice(0, 4);
          let m = value.slice(4, 6);
          if (m.length === 1) m = "0" + m;
          return m ? `${y}-${m}` : "";
        }

        // 年月日モード（例: 2025125 → 2025-12-05）
        if (mode === "date") {
          const y = value.slice(0, 4);
          let m = value.slice(4, 6);
          let d = value.slice(6, 8);
          if (m.length === 1) m = "0" + m;
          if (d.length === 1) d = "0" + d;
          return y && m && d ? `${y}-${m}-${d}` : "";
        }

        return "";
      }
    });
  }
}

/* ==========================================================
 * グローバル登録
 * ========================================================== */
window.DatePicker = DatePicker;
```

## 日付をVARCHARで持つ理由
 - 日付の登録を行う画面において年月日・年月・年などの入力を行う際に、既存のデートピッカーでは使い分けができないため
 - 例えばキャラクターの生年月日などを登録する際、まだ設定が固まっておらずとりあえず年だけを登録したい場合や、設定が固まっているので年月日を登録する場合において、HTMLの標準のカレンダーではそれらに対応できないから
 - なにか年月日・年月・年の切り替えが行えるライブラリがあれば日付をVARCHARで保持する理由もないのでできればライブラリを使用してDATE型で保持したい

## ログファイル表示内容
 - 現在年月日時分秒
 - 機能名
 - 操作
 - 更新者
 - 例外メッセージ(エラーの場合)

## 操作ログの例
```
[2025-10-07 19:21:07] 作品レビュー | 更新処理開始 | ユーザーID : ejima0902
[2025-10-07 19:21:07] 作品レビュー | 更新処理終了
```
## エラーログの例
```
[2025-10-29 19:29:24] 作中元号 | 更新処理エラー | ユーザーID : ejima0902 | error : SQLSTATE[22007]: Invalid datetime format: 7 ERROR:  invalid input syntax for type date: "2025"
CONTEXT:  unnamed portal parameter $2 = '...'
```

## ログイン者のユーザ区分
 - 一般ユーザ
 - 管理者ユーザ

## ユーザの利用者区分
 - 作成者
 - アシスタント

## 画面
  - ログイン画面
    - 既存ユーザでのログインを行う画面
  - 会員登録画面
    - 新規ユーザの登録を行う画面
  - メイン画面
    - ログイン後に遷移する画面
    - サイドバーから各画面への遷移・一覧の表示などの制御を行う
  - 作品管理画面
    - 作品情報の編集を行うための各画面への遷移などの制御を行う
  - キャラ設定画面
    - キャラクター情報の参照・登録・更新・削除を行う画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 元号設定画面
    - 作中に登場する元号名と、その開始年・終了年を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 組織設定画面
    - 作中に登場する組織情報の参照・登録・更新・削除を行う画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 年表設定画面
    - 作中での出来事年表を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 能力設定画面
    - 作中で登場する能力情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 武器設定画面
    - 作中で登場する武器情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 技設定画面
    - 作中で登場する技情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - セリフ設定画面
    - 作中で登場するセリフ情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 相関図作成画面
    - 作中に登場するキャラクターの相関図を参照・登録・更新・削除・出力する画面
    - 参照・登録・更新・削除・出力を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 舞台設定画面
    - 作中に登場する舞台情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 種族設定画面
    - 作中に登場する種族情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 作品共通情報設定画面
    - 作中の共通情報を参照・登録・更新する画面
    - 参照・登録・更新を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 作品レビュー画面
    - 作品のレビュー情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分がアシスタントのユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - チーム設定画面
    - 作中に登場する作中に登場するチーム情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 伏線メモ画面
    - 作中に登場する伏線情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 作品作成参加者一覧画面
    - 作品の作成に参加しているユーザを参照・更新する画面
    - 参照・更新を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 作中階級設定画面
    - 作中に登場する組織の階級情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 作品作成用画面
    - 作品を作成するためのメモを参照・登録・更新・削除する画面
    - 全ユーザが参照・登録・更新・削除を行えるが、更新・削除に関しては自身の投稿した内容に限り更新と削除が可能となる(他のユーザの投稿には触れない)
  - 建物設定画面
    - 作中に登場する建物情報を参照・登録・更新・削除する画面
    - 参照・登録・更新・削除を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 更新履歴一覧画面
    - 作品の更新情報を参照する画面
  - ストーリー作成画面
    - 作品のストーリー情報の参照・登録・更新・削除・出力を行う画面
    - 参照・登録・更新・削除・出力を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - プロット作成画面
    - 作品のストーリーのプロット情報の参照・登録・更新・削除・出力を行う画面
    - 参照・登録・更新・削除・出力を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 作品作成スケジュール設定画面
    - 作品を完成させるまでのスケジュールカレンダーの参照・登録・更新を行う画面
    - 参照・登録・更新を行えるのは利用者区分が作成者のユーザと、ログイン者のユーザ区分が管理者のユーザのみで、それ以外は参照のみ可能
  - 会員一覧画面
    - システムに会員登録を行っているユーザの参照・更新を行う画面
    - ログイン者のユーザ区分が管理者のユーザのみが利用可能となる画面で、それ以外のログイン者のユーザ区分では表示されない
  - 管理者一覧画面
    - 管理者として登録されているユーザの参照を行う画面
    - ログイン者のユーザ区分が管理者のユーザのみが利用可能となる画面で、それ以外のログイン者のユーザ区分では表示されない
  - フィードバック一覧画面
    - 投稿されたフィードバックの参照を行う画面
    - ログイン者のユーザ区分が管理者のユーザのみが利用可能となる画面で、それ以外のログイン者のユーザ区分では表示されない
    
## ダイアログ
 - 作品作成ダイアログ
   - 作品の登録を行うダイアログ
 - プロジェクト参加ダイアログ
   - 他作品のプロジェクトに、利用者区分をアシスタントとして登録を行うダイアログ
 - エラーダイアログ
   - エラーメッセージを表示するダイアログ
 - インフォダイアログ
   - 詳細メッセージを表示するダイアログ
 - コンファームダイアログ
   - コンファームを表示するダイアログ
 - フィードバック投稿ダイアログ
   - フィードバックの登録を行うダイアログ
 - 入力エリアダイアログ
   - 入力エリアを表示するダイアログ
   - 入力文字数や改行が多く入力されるようなフォームではこのダイアログを表示させ、入力を容易に行わせる
 - 画像ダイアログ
   - 画像の拡大表示を行うダイアログ
 - デートピッカーダイアログ
   - 年月日・年月・年の切り替えを行うダイアログ

## ログイン画面
 ### 配置要素
 - ユーザーID
   - テキストボックス
   - 12桁
 - パスワード
   - テキストボックス
   - 12桁
 - ログイン
   - ボタン
 - 会員登録
   - ボタン

 ### ログインボタン押下時
 - パスワードの入力値をバックエンドでハッシュ化
 - 入力されたユーザーIDを条件にユーザー情報テーブルから一致するレコードを取得
   - 一致するレコードが存在しない場合は「入力されたユーザーIDが存在しません」というエラーメッセージを表示して処理終了
 - 入力されたユーザーIDに紐づくレコードが存在する場合は取得したレコードのパスワードのカラムの値とハッシュ化されたパスワードの値を比較
   - パスワードの値が一致しない場合は「パスワードが一致しません」というエラーメッセージを表示して処理終了
 - パスワードが一致した場合は、取得したレコードのアカウントロックFLGがFALSEであることを確認
   - アカウントロックFLGがTRUEの場合は「凍結されたアカウントによるログインです」というエラーメッセージを表示して処理終了
 - アカウントロックFLGがFALSEであれば入力されたユーザーIDをUserIdというキーでセッションに登録
 - 入力されたユーザーIDに紐づくレコードが管理者情報テーブルに存在する場合は、ユーザ区分を管理者として扱う
   - セッションにAuthFlgというキーでtrueという文字列を設定する
 - 正常にログイン処理が終了した場合、メイン画面へ遷移を行う
 #### 入力チェック
 - ユーザーIDが入力されているか
 - パスワードが入力されているか
 
 #### 桁数チェック
 - ユーザーIDが12桁で入力されているか
 - パスワードが12桁で入力されているか

 #### 形式チェック
 - ユーザーIDに大文字と記号と数値が利用されているか
 - パスワードがユーザーIDと同じではないか

 ### 会員登録ボタン押下時
 - 会員登録画面へ遷移する

## 会員登録画面
 ### 配置要素
 - ユーザーID
   - テキストボックス
   - 12桁
 - パスワード
   - テキストボックス
   - 12桁
 - 登録
   - ボタン
 - ログインへ
   - ボタン

 ### 登録ボタン押下時
 - パスワードの入力値をバックエンドでハッシュ化
 - 入力されたユーザーIDを条件にユーザー情報テーブルから一致するレコードを取得
   - 一致するレコードが存在する場合は「入力されたユーザーIDは既に使用されています」というエラーメッセージを表示して処理終了
 - 正常なユーザーIDとパスワードであればユーザー情報テーブルに新規レコードを登録
 - 登録に成功した場合はログイン画面への遷移を行う
 #### 入力チェック
 - ユーザーIDが入力されているか
 - パスワードが入力されているか
 
 #### 桁数チェック
 - ユーザーIDが12桁で入力されているか
 - パスワードが12桁で入力されているか

 #### 形式チェック
 - ユーザーIDに大文字と記号と数値が利用されているか
 - パスワードがユーザーIDと同じではないか

 ### ログインへボタン押下時
 - ログイン画面へ遷移

## メイン画面
 ### 配置要素
 - サイドバー
   - 作品管理
     - ボタン
   - フィードバック投稿
     - ボタン
   - 会員一覧
     - ボタン
     - ログイン者のユーザ区分が管理者である場合のみ表示
   - 管理者一覧
     - ボタン
     - ログイン者のユーザ区分が管理者である場合のみ表示
   - フィードバック一覧
     - ボタン
     - ログイン者のユーザ区分が管理者である場合のみ表示
   - ログアウト
     - ボタン
 ### 作品管理ボタン押下時
 - 下記要素を作成し画面に表示(画面遷移は行わない)
   - 作品管理
     - ラベル
   - 作品作成
     - ボタン
   - プロジェクト参加
     - ボタン
   - 参加中プロジェクト一覧
     - テーブル
   - 取得件数
     - ラベル
     - ○○件の表記で表示
   - ページャー
     - ボタン
     - ロジックは共通
 - セッションからユーザーIDを取得し、参加中プロジェクトテーブルからユーザーIDを条件に一致するレコードを取得し、参加中プロジェクト一覧に表示する
   - レコードが取得できない場合は一覧に何も表示しない
   - 自身の利用者区分がアシスタントとして参加している作品も表示させるので作品情報テーブルと参加中プロジェクトテーブルを作品IDで結合して取得を行う
 #### 取得内容
 - 作品ID
   - UUID
 - ジャンル
   - 数値
 - タイトル
   - 文字列
 - 登録者
   - 文字列
 - プロジェクト参加禁止FLG
   - BOOL
 - 登録年月日
   - タイムスタンプ
 - 更新年月日
   - タイムスタンプ
 - 更新者
   - 文字列
 #### 参加中プロジェクト一覧の表示内容
 | 作品名 | ジャンル | 作成者 |作成日|最終更新者|更新年月日| | | |
|---|---|---|---|---|---|--|---|---|
| 作品のタイトル | 作品のジャンル | 作品の作成者のユーザーID |作成された年月日|最後に作品を編集したユーザのユーザーID|更新された年月日|プロジェクトへ移動(クリック可。ボタンとして扱う)|作品IDを発行(クリック可。ボタンとして扱う)| 削除(クリック可。ボタンとして扱う)
 #### 作品作成ボタン押下時
 - 作品作成ダイアログを表示
 #### プロジェクト参加ボタン押下時
 - プロジェクト参加ダイアログを表示
 #### プロジェクトへ移動セル押下時
 - 押下行のプロジェクト参加禁止FLGがFALSEであるかをチェック
   - プロジェクト参加禁止FLGがTRUEであれば、「このプロジェクトには参加できません」というエラーメッセージを表示して処理終了
 - 押下行のプロジェクト参加禁止FLGがFALSEであれば、押下行の作品IDをWorkIdというキーでセッションに保持
 - 作品管理画面へ遷移を行う
 #### 作品IDを発行セル押下時
 - 押下行の作品IDをクリップボードに張り付け
   - 「作品IDを発行しました」というインフォメッセージを表示して処理終了
 #### 削除セル押下時
 - 押下行の保持しているユーザーIDと作品IDに紐づくレコードを作品情報テーブルから取得
   - 取得レコードが存在すれば作品情報テーブルと参加中プロジェクトテーブルから作品IDに紐づくレコードを削除
   - 取得レコードが存在しなければ参加中プロジェクトテーブルからユーザーIDに紐づくレコードを削除

 ### フィードバック投稿ボタン押下時
 - フィードバック投稿ダイアログを表示

 ### 会員一覧ボタン押下時
 - 下記要素を作成し画面に表示(画面遷移は行わない)
   - 会員一覧
     - テーブル
   - 取得件数
     - ラベル
     - ○○件の表記で表示
   - ページャー
     - ボタン
     - ロジックは共通
 - ユーザー情報テーブルのレコードを、管理者情報テーブルに登録されているユーザーIDに一致しないレコードを条件に取得し、会員一覧に表示する
  - レコードが取得できない場合は一覧に何も表示しない
 #### 取得内容
 - ユーザーID
   - 文字列
 - パスワード
   - 文字列
 - 登録年月日
   - タイムスタンプ
 - 更新年月日
   - タイムスタンプ
 - 更新者
   - 文字列
 - アカウントロックFLG
   - BOOL
 #### 会員一覧表示内容
 | ユーザーID | パスワード | 登録年月日 | 更新年月日 | 更新者 | |
|---|---|---|---|---|---|
| 会員のユーザーID | 会員のパスワード | ユーザの登録年月日 | ユーザのアカウント情報の更新年月日 |ユーザのアカウント情報を更新した管理者のユーザーID|アカウントを復旧 / アカウントをロック(クリック可。ボタンとして扱う。ユーザのアカウントロックFLGがTRUEであればアカウントを復旧というラベルで表示し、FALSEであればアカウントをロックというラベルで表示する)
 #### アカウントを復旧セル押下時
 - 押下行のユーザーIDを条件にユーザー情報テーブルのアカウントロックFLGをFALSEに更新し、更新年月日を更新する
 #### アカウントをロックセル押下時
 - 押下行のユーザーIDを条件にユーザー情報テーブルのアカウントロックFLGをTRUEに更新し、更新年月日を更新する
 ### 管理者一覧ボタン押下時
 - 下記要素を作成し画面に表示(画面遷移は行わない)
   - 管理者一覧
     - テーブル
   - 取得件数
     - ラベル
     - ○○件の表記で表示
   - ページャー
     - ボタン
     - ロジックは共通
 - 管理者情報テーブルのレコードをすべて取得し、管理者一覧に表示する
  - レコードが取得できない場合は一覧に何も表示しない(この画面を表示できている時点でありえないが)
#### 取得内容
 - ユーザーID
   - 文字列
 - 登録年月日
   - タイムスタンプ
 #### 会員一覧表示内容
 | ユーザーID | 登録年月日 |
|---|---|
| 管理者のユーザーID | 管理者の登録年月日 | 
 ### フィードバック一覧ボタン押下時
 - 下記要素を作成し画面に表示(画面遷移は行わない)
   - タイトル
     - 入力フォーム
     - 非活性
   - 内容
     - 入力フォーム
     - 非活性
   - 詳細
     - ボタン
   - 保存
     - ボタン
   - フィードバック一覧
     - テーブル
   - 取得件数
     - ラベル
     - ○○件の表記で表示
   - ページャー
     - ボタン
     - ロジックは共通
 - フィードバックテーブルのレコードをすべて取得し、フィードバック一覧に表示する
  - レコードが取得できない場合は一覧に何も表示しない
 #### 取得内容
 - ユーザーID
   - 文字列
 - タイトル
   - 文字列
 - 内容
   - テキスト型文字列
 - 登録年月日
   - タイムスタンプ
 - 更新年月日
   - タイムスタンプ
 - 対応FLG
   - BOOL

 #### フィードバック一覧表示内容
 | タイトル | 内容 | 投稿年月日 | 対応年月日 | 対応者 | 対応状況 |
|---|---|---|---|---|---|
| フィードバックタイトル | フィードバック内容 | フィードバックの登録年月日 | フィードバックの更新年月日 |対応を行った管理者のユーザID| 対応FLGの内容をチェックボックスで表示(TRUEならチェック)

 #### フィードバック一覧行ダブルクリック時
 - ダブルクリック行の内容を対応する入力フォームに設定する
 #### 詳細ボタン押下時
 - 入力エリアダイアログを表示し、入力フォームに設定された内容を表示する
 #### 保存ボタン押下時
 - 対応状況チェックボックスのチェック状態で全レコードの対応FLGを更新する
   - この際、全レコードの更新年月日まで更新されないように値の変動があったレコードのみ更新年月日を更新させる
 ### ログアウトボタン押下時
 - コンファームダイアログを表示する
   - コンファームダイアログにてはいボタンが選択された場合はセッションをすべてクリアし、ログイン画面へ遷移する
   - コンファームダイアログにていいえボタンが選択された場合はコンファームダイアログを閉じる

## 作品作成ダイアログ
 ### 配置要素
 - 作品作成
   - ラベル
 - 作品名
   - 入力フォーム
   - 50桁
 - ジャンル
   - プルダウン
 - 閉じる
   - ボタン
 - 作成
   - ボタン
 ### 閉じるボタン押下時
 - 作品作成ダイアログを閉じる
 ### 作成ボタン押下時
 - UUIDを作品IDとして発行し、ユーザーIDと一緒に作品情報テーブルに画面の入力値を登録
 - 参加中プロジェクトテーブルに対しても、作成者FLGをTRUEで作品IDとユーザーIDの登録を行う
  #### 入力チェック
 - 作品IDが入力されているか

## プロジェクト参加ダイアログ 
 ### 配置要素
 - プロジェクト参加
   - ラベル
 - 作品ID
   - 入力フォーム
   - 非活性
 - 詳細ボタン
   - ボタン
 - 閉じる
   - ボタン
 - 参加
   - ボタン
 ### 詳細ボタン押下時
 - 入力エリアダイアログを表示し、入力フォームに設定された内容を表示する
 ### 閉じるボタン押下時
 - プロジェクト参加ダイアログを閉じる
 ### 参加ボタン押下時
  - 入力された作品IDが作品情報テーブルに存在しない場合
   - 「入力された作品IDに該当する作品は存在しません」というエラーメッセージを表示し処理終了
  - 入力された作品IDが作品情報テーブルに存在する場合は参加中プロジェクトテーブルに対して、作成者FLGをFALSEで作品IDとユーザーIDの登録を行う

 ## フィードバック投稿ダイアログ
 ### 配置要素
 - フィードバック
   - ラベル
 - タイトル
   - 入力フォーム
   - 100桁
 - 内容
   - 入力フォーム
   - 非活性
 - 詳細ボタン
   - ボタン
 - 閉じる
   - ボタン
 - 投稿
   - ボタン
 ### 閉じるボタン押下時
 - フィードバック投稿ダイアログを閉じる
 ### 詳細ボタン押下時
 - 入力エリアダイアログを表示し、入力フォームに設定された内容を表示する
 ### 投稿ボタン押下時
 - 入力されたタイトル・内容をフィードバックテーブルに登録
 #### 入力チェック
 - タイトルが入力されているか
 - 内容が入力されているか
  
## 入力エリアダイアログ
 ### 配置要素
 - 詳細
   - テキストエリア
 - 詳細ボタン
   - ボタン
 - 閉じる
   - ボタン
 - クリア
   - ボタン
 - 完了
   - ボタン
 ### 閉じるボタン押下時
 - 入力エリアダイアログを閉じる
 ### クリアボタン押下時
 - 詳細に入力された内容を初期化する
 ### 完了ボタン押下時
 - 詳細に入力された内容を呼び出しもとの入力フォームとDBへの登録内容を保持するhiddenのテキストエリアに設定し入力エリアダイアログを閉じる

## 画像ダイアログ
 ### 配置要素
 - 画像
   - 画像
 - 閉じる
   - ボタン
 - 削除
   - ボタン
 ### 閉じるボタン押下時
 - 画像ダイアログを閉じる
 ### 削除ボタン押下時
 - 画像ボックスに設定されている画像を削除し画像ダイアログを閉じる

【相関図の仕様】
  1.作品ごとのキャラ相関図を作成する機能
  2.相手に対しての感情(矢印線)を、キャラAからキャラBに対してドラッグで伸ばし、結び付けることができる。
  3.矢印の種類は好意・敵意・疑心・友情などがデフォルトで存在し、残りは任意で追加が可能(追加時に色も設定したいのでカラーコードなどもDBに持たせるか)
  4.相手との関係性(棒線)を、項番2と同様にキャラAからキャラBに対してドラッグで伸ばし、結び付けることができる。
    こちらもまた同様に種類の追加が可能となる。
  5.相関図に登場するキャラは、CharacterInfoテーブルに存在するキャラを使用する
  6.キャラごとにグルーピングを行う機能を追加する。詳細としては、任意の始点から左クリックをしたまま終点までドラッグを行い、キャラのグルーピングボックスを作成する。ラベルと背景色も設定を行えるようにする。
  7.個々のキャラの配置座標を記録するためにも、キャラと矢印・棒線のX軸とY軸の位置をDBに持たせるか。
  8.サイドバーにキャラのプルダウンが存在し、そこからドラッグで相関図の描画エリアに配置するイメージ
  9.画面右上にゴミ箱アイコンを表示させ、そこにドラッグされた矢印・棒線・キャラはDBと画面から削除される
    (ゴミ箱アイコンはSVGで描画可能か？)
【ストーリー作成の仕様】
  1.Word出力ボタンを押下時に、DBの内容を整形して台本形式のWordファイルを出力する(1ページ目はuserId、作成年月日、作品名を表示する)
  2.行追加ボタンを押下時にポップアップを表示し、そこで語り手と内容を入力し投稿することで更新を行う。
  3.語り手はトグルによってプルダウンと自由入力とで切り替えられるようになっており、プルダウンの場合はCharacterInfoの内容をリストに表示する。
  4.内容には、語り手が未選択でない場合は必ず文頭と文末に「」を追加し、セリフ形式に成型してDBに保存する
  5.修正時・削除時は対象の行をダブルクリックし、登録時のポップアップを表示させそこから削除か更新を行う
  6.行の位置をドラッグで入れ替えられるととても良い --ストーリー順序インデックスにて対応(2025/10/30)←システム改修に伴い、ドラッグアンドドロップでの改修を検討(2026/01/07)
 
 【プロット作成画面の仕様】
  1.Word出力ボタンを押下時に、DBの内容を整形して台本形式のWordファイルを出力する(1ページ目はuserId、作成年月日、作品名を表示する)
  2.行追加ボタンを押下時にポップアップを表示し、そこで起承転結のいずれかと内容を入力し投稿することで更新を行う。
  3.起承転結はプルダウンで表示を行う
  4.修正時・削除時は対象の行をダブルクリックし、登録時のポップアップを表示させそこから削除か更新を行う
  5.行の位置をドラッグで入れ替えられるととても良い --プロット順序インデックスにて対応(2025/10/30)←システム改修に伴い、ドラッグアンドドロップでの改修を検討(2026/01/07)
  6.登録時に起承転結の並び順で登録が行われているかをチェックする

## テーブルのクエリ(古い設計が残っていたり、未定義のテーブルも多々あり)
```
/* =========================================================================
 * 初期設定：UUID拡張機能の有効化
 * ========================================================================= */
CREATE EXTENSION IF NOT EXISTS pgcrypto;

/* =========================================================================
 * 1. システム・ユーザ管理周り
 * ========================================================================= */

-- 1.1 ユーザ情報 (UserInfo)
CREATE TABLE IF NOT EXISTS UserInfo (
    userId          VARCHAR(50)    PRIMARY KEY,            -- ユーザーID (12桁想定だが余裕を持たせる)
    passwordHash    TEXT           NOT NULL,               -- ハッシュ化パスワード
    accountLockFlg  BOOLEAN        NOT NULL DEFAULT FALSE, -- アカウントロックフラグ
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),                           -- 登録者（自己登録の場合は自身のID）
    updateUser      VARCHAR(50)                            -- 更新者
);

-- 1.2 管理者情報 (AdminInfo)
CREATE TABLE IF NOT EXISTS AdminInfo (
    userId          VARCHAR(50)    PRIMARY KEY,
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_admin_user FOREIGN KEY(userId) REFERENCES UserInfo(userId) ON DELETE CASCADE
);

-- 1.3 フィードバック (FeedBackInfo)
CREATE TABLE IF NOT EXISTS FeedBackInfo (
    feedBackId       BIGSERIAL     PRIMARY KEY,
    userId           VARCHAR(50),                          -- 投稿者 (NULL許容: 退会済みユーザ対応等)
    title            VARCHAR(100)  NOT NULL,
    content          TEXT          NOT NULL,
    responseFlg      BOOLEAN       NOT NULL DEFAULT FALSE, -- 対応完了フラグ
    registDate       TIMESTAMP(3)  NOT NULL DEFAULT current_timestamp(3),
    updateDate       TIMESTAMP(3)  NOT NULL DEFAULT current_timestamp(3),
    registUser       VARCHAR(50),
    updateUser       VARCHAR(50),
    CONSTRAINT fk_feedback_user FOREIGN KEY(userId) REFERENCES UserInfo(userId) ON DELETE SET NULL
);

/* =========================================================================
 * 2. 作品・プロジェクト管理
 * ========================================================================= */

-- 2.1 作品情報 (WorkInfo)
CREATE TABLE IF NOT EXISTS WorkInfo (
    workId          UUID           PRIMARY KEY DEFAULT gen_random_uuid(),
    workTitle       VARCHAR(255)   NOT NULL,
    genre           INTEGER        NOT NULL DEFAULT 0,     -- ジャンル区分
    projectLockFlg  BOOLEAN        NOT NULL DEFAULT FALSE, -- 参加禁止フラグ
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),                           -- 作成者
    updateUser      VARCHAR(50),
    CONSTRAINT fk_work_registUser FOREIGN KEY(registUser) REFERENCES UserInfo(userId) ON DELETE RESTRICT
);

-- 2.2 参加中プロジェクト・権限 (CreaterList)
CREATE TABLE IF NOT EXISTS CreaterList (
    id              BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    userId          VARCHAR(50)    NOT NULL,
    isCreator       BOOLEAN        NOT NULL DEFAULT FALSE, -- TRUE:作成者, FALSE:アシスタント
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_list_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_list_user FOREIGN KEY(userId) REFERENCES UserInfo(userId) ON DELETE CASCADE,
    UNIQUE (workId, userId)
);

-- 2.3 更新履歴 (UpdateHistory)
-- 機能名や操作内容を記録
CREATE TABLE IF NOT EXISTS UpdateHistory (
    historyId       BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    functionName    VARCHAR(100),                          -- 機能名
    operation       VARCHAR(100),                          -- 操作（登録・更新・削除など）
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_history_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

/* =========================================================================
 * 3. 世界観・設定データ (マスタ系含む)
 * ========================================================================= */

-- 3.1 作品共通設定 (SettingInfo)
CREATE TABLE IF NOT EXISTS SettingInfo (
    settingId       BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    key             VARCHAR(100),                          -- 設定項目キー
    value           TEXT,                                  -- 設定値
    note            TEXT,                                  -- 備考
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_setting_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 3.2 元号設定 (CalendarInfo)
CREATE TABLE IF NOT EXISTS CalendarInfo (
    caleId          BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    eraName         VARCHAR(100)   NOT NULL,
    startYear       VARCHAR(20),                           -- 年のみ、年月など不定のためVARCHAR
    endYear         VARCHAR(20),
    description     TEXT,                                  -- 概要
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_cal_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 3.3 建物設定 (BuildInfo)
CREATE TABLE IF NOT EXISTS BuildInfo (
    buildId         BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    buildName       VARCHAR(255)   NOT NULL,
    buildDate       VARCHAR(20),                           -- 建築日
    height          VARCHAR(50),
    area            VARCHAR(50),
    description     TEXT,
    imgPath         VARCHAR(255),
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_build_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 3.4 舞台・場所設定 (StageInfo)
CREATE TABLE IF NOT EXISTS StageInfo (
    stageId         BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    stageName       VARCHAR(255)   NOT NULL,
    population      VARCHAR(100),
    areaSize        VARCHAR(100),
    description     TEXT,
    imgPath         VARCHAR(255),
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_stage_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 3.5 組織設定 (OrganizationInfo)
CREATE TABLE IF NOT EXISTS OrganizationInfo (
    orgId           BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    orgName         VARCHAR(255)   NOT NULL,
    foundedDate     VARCHAR(20),
    peopleNum       VARCHAR(50),                           -- 人数（"約100人"などの表記許容のためVARCHAR推奨だがINT要件なら変更可）
    purpose         TEXT,                                  -- 目的
    activity        TEXT,                                  -- 活動内容
    baseBuildId     BIGINT,                                -- 拠点となる建物
    imgPath         VARCHAR(255),
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_org_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_org_build FOREIGN KEY(baseBuildId) REFERENCES BuildInfo(buildId) ON DELETE SET NULL
);

-- 3.6 階級設定 (ClassInfo) ※新規追加
CREATE TABLE IF NOT EXISTS ClassInfo (
    classId         BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    orgId           BIGINT,                                -- 紐づく組織（NULLなら共通階級）
    className       VARCHAR(150)   NOT NULL,
    rankOrder       INTEGER,                               -- 序列
    description     TEXT,
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_class_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_class_org FOREIGN KEY(orgId) REFERENCES OrganizationInfo(orgId) ON DELETE SET NULL
);

-- 3.7 チーム設定 (TeamInfo)
CREATE TABLE IF NOT EXISTS TeamInfo (
    teamId          BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    teamName        VARCHAR(150)   NOT NULL,
    orgId           BIGINT,                                -- 所属組織
    description     TEXT,
    imgPath         VARCHAR(255),
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_team_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_team_org FOREIGN KEY(orgId) REFERENCES OrganizationInfo(orgId) ON DELETE SET NULL
);

-- 3.8 種族設定 (RaceInfo)
CREATE TABLE IF NOT EXISTS RaceInfo (
    raceId          BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    raceName        VARCHAR(150)   NOT NULL,
    description     TEXT,
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_race_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 3.9 能力設定 (PowerInfo)
CREATE TABLE IF NOT EXISTS PowerInfo (
    powerId         BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    powerName       VARCHAR(150)   NOT NULL,
    description     TEXT,
    conditions      TEXT,                                  -- 発動条件
    risk            TEXT,                                  -- 代償・副作用
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_power_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 3.10 武器設定 (WeaponInfo)
CREATE TABLE IF NOT EXISTS WeaponInfo (
    weaponId        BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    weaponName      VARCHAR(150)   NOT NULL,
    description     TEXT,
    imgPath         VARCHAR(255),
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_weapon_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 3.11 技設定 (MoveInfo)
CREATE TABLE IF NOT EXISTS MoveInfo (
    moveId          BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    moveName        VARCHAR(150)   NOT NULL,
    description     TEXT,
    powerId         BIGINT,                                -- 関連する能力があれば
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_move_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_move_power FOREIGN KEY(powerId) REFERENCES PowerInfo(powerId) ON DELETE SET NULL
);

/* =========================================================================
 * 4. キャラクター関連
 * ========================================================================= */

-- 4.1 キャラクター情報 (CharacterInfo)
CREATE TABLE IF NOT EXISTS CharacterInfo (
    charaId         UUID           PRIMARY KEY DEFAULT gen_random_uuid(),
    workId          UUID           NOT NULL,
    charaName       VARCHAR(255)   NOT NULL,
    gender          SMALLINT,                              -- 0:不明, 1:男, 2:女 など
    birthDate       VARCHAR(20),                           -- 暦が特殊な可能性があるためVARCHAR
    age             VARCHAR(50),
    height          VARCHAR(50),
    weight          VARCHAR(50),
    bloodType       VARCHAR(10),
    raceId          BIGINT,
    orgId           BIGINT,
    teamId          BIGINT,
    classId         BIGINT,                                -- 階級
    roleInfo        TEXT,                                  -- 役割（主人公、敵など）
    personality     TEXT,                                  -- 性格
    biography       TEXT,                                  -- 生い立ち・経歴
    firstPerson     VARCHAR(50),                           -- 一人称
    secondPerson    VARCHAR(50),                           -- 二人称
    imgPath         VARCHAR(255),
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_chara_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_chara_org FOREIGN KEY(orgId) REFERENCES OrganizationInfo(orgId) ON DELETE SET NULL,
    CONSTRAINT fk_chara_team FOREIGN KEY(teamId) REFERENCES TeamInfo(teamId) ON DELETE SET NULL,
    CONSTRAINT fk_chara_class FOREIGN KEY(classId) REFERENCES ClassInfo(classId) ON DELETE SET NULL,
    CONSTRAINT fk_chara_race FOREIGN KEY(raceId) REFERENCES RaceInfo(raceId) ON DELETE SET NULL
);

-- 4.2 セリフ (SerifInfo)
CREATE TABLE IF NOT EXISTS SerifInfo (
    serifId         BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    charaId         UUID,                                  -- 誰のセリフか（NULL可）
    content         TEXT           NOT NULL,
    situation       VARCHAR(255),                          -- 場面
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_serif_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_serif_chara FOREIGN KEY(charaId) REFERENCES CharacterInfo(charaId) ON DELETE CASCADE
);

/* =========================================================================
 * 5. 相関図 (新仕様対応)
 * ========================================================================= */

-- 5.1 相関図オブジェクト配置情報 (RelationObjectInfo)
-- キャラクターやグループボックスの座標・表示設定を保持
CREATE TABLE IF NOT EXISTS RelationObjectInfo (
    objId           BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    objType         SMALLINT       NOT NULL,               -- 1:キャラクター, 2:グルーピングボックス
    targetId        UUID,                                  -- objType=1の場合のcharaId
    label           VARCHAR(255),                          -- グルーピングのラベルなど
    posX            INTEGER        NOT NULL DEFAULT 0,
    posY            INTEGER        NOT NULL DEFAULT 0,
    width           INTEGER,                               -- グループボックス用
    height          INTEGER,                               -- グループボックス用
    bgColor         VARCHAR(20),                           -- 背景色コード
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_relobj_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_relobj_chara FOREIGN KEY(targetId) REFERENCES CharacterInfo(charaId) ON DELETE CASCADE
);

-- 5.2 相関関係・線情報 (RelationInfo)
-- AからBへの矢印や線を管理
CREATE TABLE IF NOT EXISTS RelationInfo (
    relationId      BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    sourceObjId     BIGINT         NOT NULL,               -- 始点オブジェクト(RelationObjectInfo.objId)
    targetObjId     BIGINT         NOT NULL,               -- 終点オブジェクト
    lineType        SMALLINT       NOT NULL DEFAULT 1,     -- 1:矢印, 2:線
    relationType    VARCHAR(100),                          -- 「好意」「敵対」などの種別
    color           VARCHAR(20),                           -- 線の色
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_rel_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_rel_source FOREIGN KEY(sourceObjId) REFERENCES RelationObjectInfo(objId) ON DELETE CASCADE,
    CONSTRAINT fk_rel_target FOREIGN KEY(targetObjId) REFERENCES RelationObjectInfo(objId) ON DELETE CASCADE
);

/* =========================================================================
 * 6. 時系列・ストーリー・プロット
 * ========================================================================= */

-- 6.1 年表 (TimelineInfo)
CREATE TABLE IF NOT EXISTS TimelineInfo (
    timeId          BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    caleId          BIGINT,
    eventDate       VARCHAR(20)    NOT NULL,               -- 発生時期
    endDate         VARCHAR(20),
    title           VARCHAR(255)   NOT NULL,
    content         TEXT,
    relatedStageId  BIGINT,                                -- 関連する場所
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_time_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    CONSTRAINT fk_time_cale FOREIGN KEY(caleId) REFERENCES CalendarInfo(caleId) ON DELETE SET NULL,
    CONSTRAINT fk_time_stage FOREIGN KEY(relatedStageId) REFERENCES StageInfo(stageId) ON DELETE SET NULL
);

-- 6.2 ストーリー (StoryInfo)
CREATE TABLE IF NOT EXISTS StoryInfo (
    storyId         BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    indexNum        INTEGER        NOT NULL,               -- 表示順
    narrator        VARCHAR(255),                          -- 語り手（キャラ名or自由入力）
    content         TEXT,                                  -- 本文
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_story_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE,
    UNIQUE (workId, indexNum)
);

-- 6.3 プロット (PlotInfo)
CREATE TABLE IF NOT EXISTS PlotInfo (
    plotId          BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    indexNum        INTEGER        NOT NULL,
    structureType   INTEGER,                               -- 起承転結区分 (0:起, 1:承...)
    content         TEXT,
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_plot_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 6.4 伏線メモ (ClueInfo)
CREATE TABLE IF NOT EXISTS ClueInfo (
    clueId          BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    title           VARCHAR(255)   NOT NULL,
    content         TEXT,                                  -- 伏線内容
    recoveryStatus  TEXT,                                  -- 回収状況・備考
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_clue_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

/* =========================================================================
 * 7. 進行管理・その他
 * ========================================================================= */

-- 7.1 作品作成スケジュール (ScheduleInfo) ※新規追加
CREATE TABLE IF NOT EXISTS ScheduleInfo (
    scheduleId      BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    title           VARCHAR(255)   NOT NULL,
    startDate       VARCHAR(20),                           -- 開始日時 (YYYY-MM-DD HH:mm 等)
    endDate         VARCHAR(20),                           -- 終了日時
    color           VARCHAR(20),                           -- カレンダー表示色
    description     TEXT,
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_sch_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 7.2 作品作成用メモ (WorkMemoInfo) ※新規追加
-- 「自身の投稿した内容に限り更新と削除が可能」なメモ
CREATE TABLE IF NOT EXISTS WorkMemoInfo (
    memoId          BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    title           VARCHAR(255)   NOT NULL,
    content         TEXT,
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_memo_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);

-- 7.3 作品レビュー (ReviewInfo)
CREATE TABLE IF NOT EXISTS ReviewInfo (
    reviewId        BIGSERIAL      PRIMARY KEY,
    workId          UUID           NOT NULL,
    reviewerName    VARCHAR(150),                          -- レビュアー名
    reviewContent   TEXT           NOT NULL,
    evaluation      SMALLINT       NOT NULL,               -- 評価 (1:◎, 2:〇, 3:△, 4:×)
    registDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    updateDate      TIMESTAMP(3)   NOT NULL DEFAULT current_timestamp(3),
    registUser      VARCHAR(50),
    updateUser      VARCHAR(50),
    CONSTRAINT fk_review_work FOREIGN KEY(workId) REFERENCES WorkInfo(workId) ON DELETE CASCADE
);


```
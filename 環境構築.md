## Ubuntu インストール

`wsl --install -d Ubuntu-22.04`

## システム更新・基本パッケージ

`sudo apt update`
`sudo apt upgrade -y`
`sudo apt install -y apache2 postgresql postgresql-contrib git unzip curl`

## PHP と必要拡張のインストール

`sudo apt install -y php php-cli php-fpm libapache2-mod-php \
  php-pgsql php-xml php-mbstring php-curl php-zip php-gd php-intl`

## 確認

`php -v`
`php -m | grep pgsql`

## Composer のインストール

`curl -sS https://getcomposer.org/installer -o composer-setup.php`

## ハッシュ検証を入れる

`sudo php composer-setup.php --install-dir=/usr/local/bin --filename=composer`
`composer --version`
`rm composer-setup.php`

## PostgreSQL ユーザとデータベース作成

`sudo -u postgres psql`

```
-- ユーザ作成
CREATE ROLE ejima WITH LOGIN PASSWORD 'WorkManagement@2026';

-- データベース作成（オーナーを ejima に）
CREATE DATABASE "WorkManagement" OWNER ejima;

-- 必要に応じてスキーマ権限
GRANT ALL PRIVILEGES ON DATABASE "WorkManagement" TO ejima;
\q
```

## 許可するアドレスを設定

`sudo nano /etc/postgresql/14/main/postgresql.conf`

```diff
- #listen_addresses = 'localhost'
+ listen_addresses = '*'
```

## ローカル接続がパスワード認証（md5）になっているか確認

`sudo nano /etc/postgresql/14/main/pg_hba.conf`

```
# IPv4 local connections:
host    all             all             127.0.0.1/32            md5
# IPv6 local connections:
host    all             all             ::1/128                 md5
# WSL2 (Windows側) からの接続許可
host all all 172.20.14.20/20 md5
```

## PostgreSQL 再起動

`sudo systemctl restart postgresql`

## プロジェクトのクローン

`sudo git clone https://github.com/ejimasyota/NewWorkManagment.git`
`sudo chown -R $USER:www-data /var/www/NewWorkManagment`
`sudo chmod -R 775 /var/www/NewWorkManagment`

## 仮想ホスト作成

`sudo nano /etc/apache2/sites-available/NewWorkmanagement.conf`

```
<VirtualHost *:8085>
    ServerName NewWorkManagment.local
    DocumentRoot /var/www/NewWorkManagment

    <Directory /var/www/NewWorkManagment>
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/NewWorkManagment.log
    CustomLog ${APACHE_LOG_DIR}/NewWorkManagment_access.log combined
</VirtualHost>
```

## 有効化

`sudo a2ensite NewWorkmanagement.conf`
`sudo a2enmod rewrite headers`
`sudo systemctl reload apache2`

## ポートを変更

`sudo nano /etc/apache2/ports.conf `

```diff
-Listen 80
+Listen 8085
```

## 有効化

`sudo a2ensite NewWorkmanagement.conf`
`sudo a2enmod rewrite headers`
`sudo systemctl reload apache2`

## バックの権限を設定

`sudo chgrp -R www-data /var/www/NewWorkManagment/Back`
`sudo chmod -R g+w /var/www/NewWorkManagment/Back`

## PHPWord を導入

`cd /var/www/NewWorkManagement`
`composer require phpoffice/phpword`
